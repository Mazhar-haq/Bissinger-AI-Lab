<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bissinger's Truffle Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .date-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .date-inputs-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group label {
            font-weight: 600;
            color: #2c3e50;
            white-space: nowrap;
        }

        .input-group input, .input-group select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            background: #fff;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .location-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow-x: auto;
        }

        .location-header {
            background: linear-gradient(135deg, #8e44ad, #c0392b);
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .location-header h2 {
            font-size: 1.5rem;
            margin: 0;
        }

        .location-header p {
            opacity: 0.9;
            font-size: 0.9rem;
            margin: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 600px; /* Ensure table doesn't squish too much on mobile */
        }

        thead {
            background: #34495e;
            color: white;
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #ddd;
        }

        td {
            padding: 10px 12px;
            border: 1px solid #ddd;
        }

        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        tbody tr:hover {
            background: #e3f2fd;
        }

        input[type="number"] {
            width: 100%;
            max-width: 100px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #3498db;
        }

        .flavor-name {
            font-weight: 500;
            color: #2c3e50;
        }

        .calculated {
            background: #e8f5e9;
            font-weight: 700;
            color: #2e7d32;
            text-align: center;
        }

        /* Highlight negative sales or logic errors */
        .calculated.error {
            background: #ffebee;
            color: #c62828;
        }

        .summary-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-top: 30px;
        }

        .summary-header {
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid #3498db;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .summary-card h3 {
            color: #7f8c8d;
            font-size: 0.85rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .summary-card p {
            font-size: 2.2rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .btn {
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn:active {
            transform: scale(0.98);
        }

        .export-btn {
            background: #27ae60;
            color: white;
        }

        .export-btn:hover {
            background: #219150;
        }

        .save-btn {
            background: #3498db;
            color: white;
        }

        .save-btn:hover {
            background: #2980b9;
        }

        .clear-btn {
            background: #e74c3c;
            color: white;
        }

        .clear-btn:hover {
            background: #c0392b;
        }
        
        .print-btn {
            background: #95a5a6;
            color: white;
        }
        
        .print-btn:hover {
            background: #7f8c8d;
        }

        input[type="number"]:disabled {
            background: #e9ecef;
            cursor: not-allowed;
            color: #7f8c8d;
            border-color: #ecf0f1;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2c3e50;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 9999;
            transform: translateY(-100px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateY(0);
        }

        @media print {
            .export-btn, .save-btn, .clear-btn, .print-btn {
                display: none;
            }
            body {
                background: white;
                padding: 0;
            }
            .header, .location-section, .summary-section {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        @media (max-width: 768px) {
            .date-section {
                flex-direction: column;
                align-items: stretch;
            }
            .date-inputs-container {
                flex-direction: column;
                align-items: stretch;
            }
            .input-group {
                flex-direction: column;
                align-items: flex-start;
            }
            .input-group input, .input-group select {
                width: 100%;
            }
            .action-buttons {
                justify-content: stretch;
            }
            .btn {
                flex: 1;
            }
        }
    </style>
</head>
<body onload="init()">
    <div id="toast" class="toast">Action Successful</div>

    <div class="header">
        <h1>Bissinger's Daily Truffle Inventory</h1>
        <p>Track, Calculate, and Export Daily Stock</p>
    </div>

    <div class="date-section">
        <div class="date-inputs-container">
            <div class="input-group">
                <label>Date:</label>
                <input type="date" id="trackingDate" onchange="saveData()">
            </div>
            
            <div class="input-group">
                <label>Opening MOD:</label>
                <select id="openingMod" onchange="saveData()">
                    <option value="">Select MOD</option>
                    <option value="Tom">Tom</option>
                    <option value="Arin">Arin</option>
                    <option value="Czar">Czar</option>
                    <option value="Faith">Faith</option>
                    <option value="Gully">Gully</option>
                    <option value="Associate">Associate</option>
                </select>
            </div>
            
            <div class="input-group">
                <label>Closing MOD:</label>
                <select id="closingMod" onchange="saveData()">
                    <option value="">Select MOD</option>
                    <option value="Tom">Tom</option>
                    <option value="Arin">Arin</option>
                    <option value="Czar">Czar</option>
                    <option value="Faith">Faith</option>
                    <option value="Gully">Gully</option>
                    <option value="Associate">Associate</option>
                </select>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="btn save-btn" onclick="saveCounts()">Lock AM Counts</button>
            <button class="btn clear-btn" onclick="clearAll()">Reset All</button>
        </div>
    </div>

    <!-- 6th Floor Section -->
    <div class="location-section">
        <div class="location-header">
            <h2>6th Floor Location</h2>
            <p>37 Truffle Flavors</p>
        </div>
        <table id="floor6Table">
            <thead>
                <tr>
                    <th style="width: 30%">Truffle Flavor</th>
                    <th style="width: 15%">AM Count</th>
                    <th style="width: 15%">PM Count</th>
                    <th style="width: 15%">Sold</th>
                    <th style="width: 15%">Refill</th>
                    <th style="width: 10%">End Count</th>
                </tr>
            </thead>
            <tbody id="floor6Body">
            </tbody>
        </table>
    </div>

    <!-- 1st Floor Section -->
    <div class="location-section">
        <div class="location-header">
            <h2>1st Floor Location</h2>
            <p>12 Truffle Flavors</p>
        </div>
        <table id="floor1Table">
            <thead>
                <tr>
                    <th style="width: 30%">Truffle Flavor</th>
                    <th style="width: 15%">AM Count</th>
                    <th style="width: 15%">PM Count</th>
                    <th style="width: 15%">Sold</th>
                    <th style="width: 15%">Refill</th>
                    <th style="width: 10%">End Count</th>
                </tr>
            </thead>
            <tbody id="floor1Body">
            </tbody>
        </table>
    </div>

    <!-- Summary Section -->
    <div class="summary-section">
        <div class="summary-header">
            <h2>Daily Summary</h2>
        </div>
        <div class="summary-grid">
            <div class="summary-card">
                <h3>6th Floor Sold</h3>
                <p id="floor6Total">0</p>
            </div>
            <div class="summary-card">
                <h3>1st Floor Sold</h3>
                <p id="floor1Total">0</p>
            </div>
            <div class="summary-card">
                <h3>Total Sold</h3>
                <p id="combinedTotal">0</p>
            </div>
            <div class="summary-card">
                <h3>Total Refills</h3>
                <p id="totalRefills">0</p>
            </div>
        </div>
        <div class="action-buttons">
            <button class="btn export-btn" onclick="exportToCSV()">Export CSV</button>
            <button class="btn print-btn" onclick="window.print()">Print Report</button>
        </div>
    </div>

    <script>
        const floor6Flavors = [
            "Birthday Cake Truffle", "Wedding Cake Truffle", "Root Beer Float Truffle",
            "Milk Chocolate Raspberry Cream", "Dark Chocolate Candy Cane", "Dark Raspberry Truffle",
            "Creme Brulee Truffle", "Tiramisu Truffle", "Pineapple Upside Down Cake Truffle",
            "Red Velvet Cake Truffle", "Irish Cream Truffle", "Chocolate Souffle Truffle",
            "White Euro Truffle", "White Russian Truffle", "Chocolate Milk Shake Truffle",
            "Dark Chocolate Caramel Macchiato Truffle", "German Chocolate Truffle",
            "Dark Chocolate Cherry Cordials", "Milk Swiss Chocolate Truffle",
            "Dark Swiss Chocolate Truffle", "Dark Sea Salt Caramel Truffle",
            "Strawberry Truffle", "Strawberry Cheese Cake Truffle", "Pistachio Crown Truffle",
            "Italian Espresso Truffle", "Dark Chocolate Caramel", "Fresh Mint Truffle",
            "Dark Creme Mints", "Milk Sea Salt Caramel", "Dark Cinnamon Almond Caramel",
            "Milk Chocolate Swiss Pecan Cream", "Milk Vanilla Dreams", "French Vanilla B",
            "Milk Chocolate English Almond Toffee", "Dark Chocolate English Almond Toffee",
            "Dark Lemon Creme", "Raspberry Caramel Jewel"
        ];

        const floor1Flavors = [
            "Birthday Cake Truffle", "Wedding Cake Truffle", "White Euro Truffle",
            "Dark Chocolate Sea Salt Caramel", "White Chocolate Christmas Cookie Truffle",
            "Dark Chocolate Candy Cane", "White Chocolate Eggnog",
            "Milk Chocolate Caramel Fudge Brownie", "Milk Chocolate Peanut Butter",
            "Milk Chocolate French Salt Caramel", "Cherry Cordials",
            "Milk Chocolate Swiss Pecan Creme"
        ];

        // --- Initialization ---

        function init() {
            // Set today's date if empty
            const dateInput = document.getElementById('trackingDate');
            if (!dateInput.value) {
                dateInput.valueAsDate = new Date();
            }

            // Generate rows
            generateRows(floor6Flavors, 'floor6Body', 'f6');
            generateRows(floor1Flavors, 'floor1Body', 'f1');

            // Load data from local storage
            loadSavedData();
        }

        function generateRows(flavors, tbodyId, prefix) {
            const tbody = document.getElementById(tbodyId);
            flavors.forEach((flavor, idx) => {
                const id = `${prefix}_${idx}`;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="flavor-name">${flavor}</td>
                    <td><input type="number" id="${id}_am" min="0" placeholder="0" onchange="calculate('${id}'); saveData();"></td>
                    <td><input type="number" id="${id}_pm" min="0" placeholder="0" onchange="calculate('${id}'); saveData();"></td>
                    <td class="calculated" id="${id}_sold">0</td>
                    <td><input type="number" id="${id}_refill" min="0" placeholder="0" onchange="calculate('${id}'); saveData();"></td>
                    <td class="calculated" id="${id}_end">0</td>
                `;
                tbody.appendChild(row);
            });
        }

        // --- Core Logic ---

        function calculate(id) {
            const amInput = document.getElementById(`${id}_am`);
            const pmInput = document.getElementById(`${id}_pm`);
            const refillInput = document.getElementById(`${id}_refill`);
            
            const am = parseInt(amInput.value) || 0;
            const pm = parseInt(pmInput.value) || 0;
            const refill = parseInt(refillInput.value) || 0;
            
            const soldElement = document.getElementById(`${id}_sold`);
            const endElement = document.getElementById(`${id}_end`);

            // Logic: Sold = AM - PM. 
            let sold = am - pm;
            
            if (sold < 0) {
                 soldElement.classList.add('error');
            } else {
                 soldElement.classList.remove('error');
            }

            // End Count logic: Usually PM count + Refill (what's physically there now)
            // Or is it (AM - Sold) + Refill?
            // If PM count is the ACTUAL count taken at end of shift, then End Count = PM + Refill
            const endCount = pm + refill;
            
            soldElement.textContent = sold;
            endElement.textContent = endCount;
            
            updateSummary();
        }

        function updateSummary() {
            let floor6Sold = 0;
            let floor1Sold = 0;
            let totalRefills = 0;

            // Calculate 6th floor
            floor6Flavors.forEach((_, idx) => {
                const sold = parseInt(document.getElementById(`f6_${idx}_sold`).textContent) || 0;
                const refill = parseInt(document.getElementById(`f6_${idx}_refill`).value) || 0;
                floor6Sold += sold; 
                totalRefills += refill;
            });

            // Calculate 1st floor
            floor1Flavors.forEach((_, idx) => {
                const sold = parseInt(document.getElementById(`f1_${idx}_sold`).textContent) || 0;
                const refill = parseInt(document.getElementById(`f1_${idx}_refill`).value) || 0;
                floor1Sold += sold;
                totalRefills += refill;
            });

            document.getElementById('floor6Total').textContent = floor6Sold;
            document.getElementById('floor1Total').textContent = floor1Sold;
            document.getElementById('combinedTotal').textContent = floor6Sold + floor1Sold;
            document.getElementById('totalRefills').textContent = totalRefills;
        }

        // --- Data Persistence ---

        function saveData() {
            const data = {
                date: document.getElementById('trackingDate').value,
                openingMod: document.getElementById('openingMod').value,
                closingMod: document.getElementById('closingMod').value,
                floor6: {},
                floor1: {}
            };

            // Save 6th Floor
            floor6Flavors.forEach((_, idx) => {
                const id = `f6_${idx}`;
                data.floor6[id] = {
                    am: document.getElementById(`${id}_am`).value,
                    pm: document.getElementById(`${id}_pm`).value,
                    refill: document.getElementById(`${id}_refill`).value,
                    locked: document.getElementById(`${id}_am`).disabled
                };
            });

            // Save 1st Floor
            floor1Flavors.forEach((_, idx) => {
                const id = `f1_${idx}`;
                data.floor1[id] = {
                    am: document.getElementById(`${id}_am`).value,
                    pm: document.getElementById(`${id}_pm`).value,
                    refill: document.getElementById(`${id}_refill`).value,
                    locked: document.getElementById(`${id}_am`).disabled
                };
            });

            localStorage.setItem('bissingersTrackerData', JSON.stringify(data));
        }

        function loadSavedData() {
            const savedData = localStorage.getItem('bissingersTrackerData');
            if (!savedData) return;

            try {
                const data = JSON.parse(savedData);

                if (data.date) document.getElementById('trackingDate').value = data.date;
                if (data.openingMod) document.getElementById('openingMod').value = data.openingMod;
                if (data.closingMod) document.getElementById('closingMod').value = data.closingMod;

                // Restore Floor 6
                if (data.floor6) {
                    Object.keys(data.floor6).forEach(id => {
                        const item = data.floor6[id];
                        const amInput = document.getElementById(`${id}_am`);
                        if (amInput) {
                            amInput.value = item.am;
                            document.getElementById(`${id}_pm`).value = item.pm;
                            document.getElementById(`${id}_refill`).value = item.refill;
                            if (item.locked) amInput.disabled = true;
                            calculate(id);
                        }
                    });
                }

                // Restore Floor 1
                if (data.floor1) {
                    Object.keys(data.floor1).forEach(id => {
                        const item = data.floor1[id];
                        const amInput = document.getElementById(`${id}_am`);
                        if (amInput) {
                            amInput.value = item.am;
                            document.getElementById(`${id}_pm`).value = item.pm;
                            document.getElementById(`${id}_refill`).value = item.refill;
                            if (item.locked) amInput.disabled = true;
                            calculate(id);
                        }
                    });
                }

                showToast("Data restored from memory");
            } catch (e) {
                console.error("Error loading data", e);
            }
        }

        function saveCounts() {
            // Locks the AM counts to prevent editing
            const confirmLock = confirm("Are you sure you want to lock the AM counts? You won't be able to edit them afterwards.");
            if (!confirmLock) return;

            // Lock Floor 6
            floor6Flavors.forEach((_, idx) => {
                const el = document.getElementById(`f6_${idx}_am`);
                if(el) el.disabled = true;
            });

            // Lock Floor 1
            floor1Flavors.forEach((_, idx) => {
                const el = document.getElementById(`f1_${idx}_am`);
                if(el) el.disabled = true;
            });

            saveData(); // Save the locked state
            showToast("AM Counts Locked");
        }

        function clearAll() {
            if(!confirm("Are you sure you want to clear all data? This cannot be undone.")) return;

            // Clear Inputs and unlock
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.value = "";
                input.disabled = false;
            });

            // Reset dropdowns
            document.getElementById('openingMod').value = "";
            document.getElementById('closingMod').value = "";
            
            // Reset totals
            document.querySelectorAll('.calculated').forEach(el => {
                el.textContent = "0";
                el.classList.remove('error');
            });

            // Clear Local Storage
            localStorage.removeItem('bissingersTrackerData');
            
            // Recalculate to zero out summaries
            updateSummary();
            showToast("All data cleared");
        }

        function exportToCSV() {
            const date = document.getElementById('trackingDate').value;
            const openMod = document.getElementById('openingMod').value;
            const closeMod = document.getElementById('closingMod').value;
            
            let csv = `Bissinger's Truffle Report\n`;
            csv += `Date,${date}\n`;
            csv += `Opening MOD,${openMod}\n`;
            csv += `Closing MOD,${closeMod}\n\n`;
            
            csv += `6TH FLOOR\n`;
            csv += `Flavor,AM Count,PM Count,Sold,Refill,End Count\n`;
            
            floor6Flavors.forEach((flavor, idx) => {
                const am = document.getElementById(`f6_${idx}_am`).value || 0;
                const pm = document.getElementById(`f6_${idx}_pm`).value || 0;
                const sold = document.getElementById(`f6_${idx}_sold`).textContent;
                const refill = document.getElementById(`f6_${idx}_refill`).value || 0;
                const end = document.getElementById(`f6_${idx}_end`).textContent;
                csv += `"${flavor}",${am},${pm},${sold},${refill},${end}\n`;
            });
            
            csv += `\n1ST FLOOR\n`;
            csv += `Flavor,AM Count,PM Count,Sold,Refill,End Count\n`;
            
            floor1Flavors.forEach((flavor, idx) => {
                const am = document.getElementById(`f1_${idx}_am`).value || 0;
                const pm = document.getElementById(`f1_${idx}_pm`).value || 0;
                const sold = document.getElementById(`f1_${idx}_sold`).textContent;
                const refill = document.getElementById(`f1_${idx}_refill`).value || 0;
                const end = document.getElementById(`f1_${idx}_end`).textContent;
                csv += `"${flavor}",${am},${pm},${sold},${refill},${end}\n`;
            });
            
            csv += `\nSUMMARY\n`;
            csv += `6th Floor Sold,${document.getElementById('floor6Total').textContent}\n`;
            csv += `1st Floor Sold,${document.getElementById('floor1Total').textContent}\n`;
            csv += `Total Sold,${document.getElementById('combinedTotal').textContent}\n`;
            csv += `Total Refills,${document.getElementById('totalRefills').textContent}\n`;

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Bissinger_Truffle_Report_${date}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
