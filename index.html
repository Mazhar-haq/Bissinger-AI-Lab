<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bissinger's Truffle Tracker ¬∑ Herald Square</title>
    <style>
        /* === EXACT REFERENCE FONT & STYLE === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* The correct font stack from the reference */
        body {
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
            background: #f2eee9;
            color: #1e2a24;
            padding: 10px 12px 200px 12px;
            line-height: 1.4;
        }

        /* header ‚Äì deep brown / gold exactly like reference */
        .header-bar {
            background: #3d2f21;
            color: #e2c28b;
            padding: 16px 14px;
            border-radius: 8px 8px 0 0;
            margin-bottom: 16px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            border-bottom: 3px solid #b3914b;
        }
        .header-bar h1 {
            font-size: 1.5rem;
            font-weight: 500;
            letter-spacing: 0.5px;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        .date-badge {
            background: #524433;
            padding: 5px 14px;
            border-radius: 40px;
            font-size: 0.9rem;
            color: #f5d896;
        }
        .help-link {
            background: none;
            border: 1px solid #b3914b;
            color: #e2c28b;
            padding: 6px 16px;
            border-radius: 30px;
            font-size: 0.9rem;
            cursor: pointer;
            font-family: inherit;
        }
        .help-link:hover {
            background: #b3914b;
            color: #2d241a;
        }

        /* guide card */
        .guide-card {
            background: #fffbf2;
            border-left: 6px solid #b9974c;
            border-radius: 12px;
            padding: 18px 20px;
            margin: 0 0 22px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            display: none;
        }
        .guide-card.show { display: block; }
        .guide-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .guide-item {
            flex: 1 1 150px;
            background: white;
            padding: 14px;
            border-radius: 20px;
            border: 1px solid #efdeb9;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        .guide-item strong { color: #886c34; }

        /* control panel */
        .control-panel {
            background: white;
            border-radius: 16px;
            padding: 18px 16px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(93, 73, 41, 0.1);
            border: 1px solid #e5d7bf;
        }
        .flex-row {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 16px;
        }
        .field {
            flex: 1 1 160px;
        }
        .field label {
            display: block;
            font-size: 0.7rem;
            text-transform: uppercase;
            color: #7c623b;
            font-weight: 600;
            margin-bottom: 4px;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        input, select {
            width: 100%;
            padding: 10px 10px;
            border: 1px solid #d4c3a8;
            border-radius: 30px;
            background: #fffcf5;
            font-size: 0.9rem;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        input:focus, select:focus {
            border-color: #b0883a;
            outline: none;
            box-shadow: 0 0 0 2px rgba(176,136,58,0.2);
        }

        .button-strip {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .btn-primary {
            background: #b0883a;
            border: none;
            padding: 12px 20px;
            border-radius: 40px;
            font-weight: 600;
            color: white;
            flex: 2;
            cursor: pointer;
            border-bottom: 3px solid #6c4f24;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        .btn-primary:active { transform: translateY(2px); border-bottom-width: 1px; }
        .btn-primary:disabled {
            opacity: 0.6;
            background: #aa9a7a;
            border-bottom-color: #73613c;
        }
        .btn-secondary {
            background: #e7dfd1;
            border: 1px solid #a58757;
            padding: 12px 16px;
            border-radius: 40px;
            font-weight: 600;
            flex: 1;
            cursor: pointer;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        .btn-danger {
            background: transparent;
            border: 2px solid #b15d47;
            color: #a1432c;
            font-weight: bold;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 0.8rem;
            width: 100%;
            margin-top: 16px;
            cursor: pointer;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }

        /* floor tabs */
        .floor-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0 10px 0;
        }
        .tab-btn {
            flex: 1;
            background: #ddd2c0;
            border: none;
            padding: 14px 0;
            border-radius: 40px;
            font-weight: 700;
            font-size: 1rem;
            color: #353027;
            cursor: pointer;
            box-shadow: 0 2px 0 #9f8a6b;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        .tab-btn.active {
            background: #3d2f21;
            color: #f5da99;
            box-shadow: 0 3px 0 #b0883a;
        }

        .floor-view { display: none; }
        .floor-view.active { display: block; }

        /* table styling */
        .table-wrapper {
            background: white;
            border-radius: 18px;
            padding: 2px 2px 10px 2px;
            box-shadow: 0 8px 12px rgba(71, 56, 31, 0.1);
            overflow-x: auto;
            margin-bottom: 10px;
            border: 1px solid #ebdbc0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 550px;
        }
        th {
            background: #e9dccb;
            color: #2d3a2b;
            font-size: 0.7rem;
            padding: 12px 3px;
            text-transform: uppercase;
            font-weight: 700;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        td {
            padding: 8px 3px;
            border-bottom: 1px solid #eedfc9;
            text-align: center;
            font-size: 0.85rem;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        td:first-child {
            text-align: left;
            font-weight: 500;
            color: #2b4a32;
            padding-left: 10px;
        }
        .half-badge {
            background: #bfa573;
            color: #1f261c;
            font-size: 0.6rem;
            padding: 2px 8px;
            border-radius: 30px;
            margin-left: 6px;
            font-weight: 600;
            white-space: nowrap;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }

        .count-input {
            width: 52px;
            padding: 5px 2px;
            text-align: center;
            border: 1px solid #cbad7a;
            border-radius: 30px;
            background: #fffcf2;
            font-weight: 600;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        .count-input:disabled {
            background: #ece1cf;
            color: #5f543e;
        }
        .sold-cell {
            color: #287846;
            font-weight: 700;
        }
        .end-cell {
            font-weight: 600;
        }
        .low-stock {
            color: #b13b2c;
            font-weight: 800;
        }

        /* footer */
        .summary-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #2d3a2b;
            color: #faeac1;
            padding: 12px 15px 18px 15px;
            border-top: 4px solid #b9974c;
            box-shadow: 0 -8px 14px #2a1f12a0;
        }
        .summary-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
        }
        .stat-block {
            text-align: center;
        }
        .stat-label {
            font-size: 0.65rem;
            opacity: 0.9;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        .stat-number {
            font-size: 1.8rem;
            font-weight: 600;
            color: #f3d78c;
            line-height: 1;
        }
        .top-sellers-box {
            background: #384e3b;
            border-radius: 30px;
            padding: 10px 16px;
        }
        .seller-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 5px;
        }
        .seller-tag {
            background: #48614b;
            padding: 4px 12px;
            border-radius: 30px;
            border: 1px solid #b9974c;
            color: white;
            font-size: 0.7rem;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }

        /* modal & toast */
        .modal {
            display: none;
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }
        .modal-card {
            background: #fffcf2;
            padding: 24px 16px;
            border-radius: 36px;
            width: 280px;
            text-align: center;
            border: 3px solid #b0883a;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        .modal-btn {
            background: #3d2f21;
            color: #e2c28b;
            border: none;
            padding: 12px;
            border-radius: 60px;
            margin: 8px 0;
            width: 100%;
            font-weight: bold;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        .toast {
            position: fixed; bottom: 140px; left: 50%; transform: translateX(-50%);
            background: #1f2a1f; color: #f3da9b;
            padding: 10px 22px; border-radius: 60px;
            opacity: 0; transition: 0.2s; z-index: 4000;
            font-family: 'Optima', 'Palatino', 'Segoe UI', serif;
        }
        @media print { .summary-footer, .tab-btn, .help-link, .btn-danger { display: none; } }
    </style>
</head>
<body onload="init()">

<div class="toast" id="toast">‚úì</div>

<div class="header-bar">
    <h1>Bissinger's Truffle Tracker</h1>
    <span class="date-badge" id="displayDate"></span>
    <button class="help-link" onclick="toggleGuide()">üìñ GUIDE</button>
</div>

<div id="guideCard" class="guide-card">
    <div class="guide-row">
        <div class="guide-item"><strong>‚òÄÔ∏è Morning</strong><br>Enter AM counts. <span style="color:#886c34;">Lock AM</span> when done.</div>
        <div class="guide-item"><strong>üßÆ Sold</strong><br>Sold = (AM ‚àí PM) + Refill<br>End = PM</div>
        <div class="guide-item"><strong>üåô Evening</strong><br>Enter PM counts. Sold auto‚Äëcalculated.</div>
    </div>
    <button onclick="toggleGuide()" style="margin-top:12px; background:#b0883a; border:0; color:white; padding:8px 20px; border-radius:30px">CLOSE</button>
</div>

<!-- top controls -->
<div class="control-panel">
    <div class="flex-row">
        <div class="field"><label>üìÖ Date</label><input type="date" id="trackingDate" onchange="updateDateDisplay(); saveAll()"></div>
        <div class="field"><label>üîì Opening MOD</label>
            <select id="openingMod" onchange="saveAll()"><option>Arin</option><option>Czar</option><option>Faith</option><option>Gully</option><option>Associate</option></select>
        </div>
        <div class="field"><label>üîí Closing MOD</label>
            <select id="closingMod" onchange="saveAll()"><option>Arin</option><option>Czar</option><option>Faith</option><option>Gully</option><option>Associate</option></select>
        </div>
    </div>
    <div class="button-strip">
        <button class="btn-primary" id="lockAmBtn" onclick="lockAM()">üîí Lock AM Counts</button>
        <button class="btn-secondary" onclick="openReportModal()">üìã Report</button>
        <button class="btn-secondary" onclick="window.print()">üñ®Ô∏è PDF</button>
    </div>
    <button class="btn-danger" onclick="confirmReset()">üóëÔ∏è Clear Today's Data</button>
</div>

<!-- floor tabs -->
<div class="floor-tabs">
    <button class="tab-btn active" id="btn-f6" onclick="switchFloor('f6')">6th Floor Case</button>
    <button class="tab-btn" id="btn-f1" onclick="switchFloor('f1')">1st Floor Case</button>
</div>

<!-- 6th floor table -->
<div id="f6-view" class="floor-view active">
    <div class="table-wrapper">
        <table id="f6Table">
            <thead><tr><th>Flavor (6th)</th><th>AM</th><th>Refill</th><th>PM</th><th>Sold</th><th>End</th></tr></thead>
            <tbody id="f6Body"></tbody>
        </table>
    </div>
</div>

<!-- 1st floor table -->
<div id="f1-view" class="floor-view">
    <div class="table-wrapper">
        <table id="f1Table">
            <thead><tr><th>Flavor (1st)</th><th>AM</th><th>Refill</th><th>PM</th><th>Sold</th><th>End</th></tr></thead>
            <tbody id="f1Body"></tbody>
        </table>
    </div>
</div>

<!-- footer summary -->
<div class="summary-footer">
    <div class="summary-stats">
        <div class="stat-block"><span class="stat-label">F6 STOCK</span><div class="stat-number" id="total-f6">0</div></div>
        <div class="stat-block"><span class="stat-label">F1 STOCK</span><div class="stat-number" id="total-f1">0</div></div>
        <div class="stat-block"><span class="stat-label">GRAND</span><div class="stat-number" id="total-grand">0</div></div>
    </div>
    <div class="top-sellers-box">
        <div style="font-weight:600; margin-bottom:5px;">üèÜ Top 5 Sold Today</div>
        <div id="topSellersList" class="seller-list"></div>
    </div>
</div>

<!-- report modal -->
<div id="reportModal" class="modal">
    <div class="modal-card">
        <h3 style="margin-bottom:15px">üìã Report</h3>
        <button class="modal-btn" onclick="generateReport('am')">üìã Copy AM Report</button>
        <button class="modal-btn" style="background:#b0883a; color:white;" onclick="generateReport('pm')">üìã Copy PM Report</button>
        <button onclick="closeReportModal()" style="margin-top:12px; background:transparent; border:1px solid #8f7b5c; padding:8px; border-radius:30px">Cancel</button>
    </div>
</div>

<script>
    // ---------- FLAVOR LISTS (exact same) ----------
    const f6List = [
        "BIRTHDAY CAKE TRUFFLE","WEDDING CAKE TRUFFLE","MILK CHOCOLATE CARAMEL CHEESECAKE TRUFFLE","RED VELVET CAKE TRUFFLE","MILK CHOCOLATE CHERRY CORDIALS","DARK CHOCOLATE CHERRY CORDIALS","STRAWBERRY TRUFFLE","DARK CHOCOLATE RASPBERRY TRUFFLE","DARK CHOCOLATE CHAMPAGNE TRUFFLE","RASPBERRY CARAMEL JEWEL","STRAWBERRY CHEESECAKE TRUFFLE","IRISH CREME TRUFFLE","WHITE RUSSIAN TRUFFLE","CREME BR√õL√âE TRUFFLE","TIRAMISU TRUFFLE","DARK CHOCOLATE CARAMEL MACCHIATO TRUFFLE","ITALIAN ESPRESSO TRUFFLE","GERMAN CHOCOLATE TRUFFLE","DARK CHOCOLATE SOUFFL√â TRUFFLE","PINEAPPLE UPSIDE DOWN CAKE TRUFFLE","WHITE EURO TRUFFLE","DARK CHOCOLATE FRENCH VANILLA TRUFFLE","FRENCH VANILLA \"B\"","CHOCOLATE MILKSHAKE TRUFFLE","MILK CHOCOLATE CARAMEL FUDGE BROWNIE TRUFFLE","MILK SWISS CHOCOLATE TRUFFLE","DARK SWISS CHOCOLATE TRUFFLE","MILK SEA SALT CARAMEL","DARK CHOCOLATE HIMALAYAN SEA SALT CARAMEL","DARK CHOCOLATE CARAMEL","MILK CHOCOLATE DOUBLE CHOCOLATE CARAMEL","DARK SEA SALT CARAMEL TRUFFLE","FRESH MINT TRUFFLE","DARK CREME MINTS","MILK CHOCOLATE MAPLE PECAN CREAM","DARK CHOCOLATE MAPLE PECAN CREAM","PISTACHIO CROWN TRUFFLE","DARK CHOCOLATE FRENCH VANILLA DREAM","MILK VANILLA DREAMS","LEMON TEARDROP TRUFFLE","MILK CHOCOLATE SWISS PECAN CREAM","DARK CHOCOLATE RASPBERRY CREME","MILK CHOCOLATE RASPBERRY CREME","MILK ORANGE CREME","DARK CHOCOLATE ORANGE CREME","ROOT BEER FLOAT TRUFFLE","MILK CHOCOLATE ENGLISH ALMOND TOFFEE","DARK CINNAMON ALMOND CARAMEL","MILK CHOCOLATE PECAN CARAMEL","MILK CHOCOLATE PEANUT BUTTER TRUFFLE"
    ];
    const f1List = [
        "MILK CHOCOLATE CARAMEL FUDGE BROWNIE TRUFFLE","FRESH MINT TRUFFLE","BIRTHDAY CAKE TRUFFLE","MILK CHOCOLATE TIRAMISU TRUFFLE","WHITE EURO TRUFFLE","MILK CHOCOLATE STRAWBERRY TRUFFLE","DARK CHOCOLATE RASPBERRY TRUFFLE","WEDDING CAKE TRUFFLE","RASPBERRY CARAMEL JEWEL TRUFFLE","MILK CHOCOLATE RED VELVET TRUFFLE","DARK CHOCOLATE FRENCH VANILLA \"B\"","MILK CHOCOLATE FRENCH SEA SALT CARAMEL","DARK CHOCOLATE SEA SALT CARAMEL","MILK CHOCOLATE SWISS PECAN CREAM","PISTACHIO CROWN TRUFFLES"
    ];

    const f6Half = ["WEDDING CAKE TRUFFLE","MILK CHOCOLATE CARAMEL CHEESECAKE TRUFFLE","MILK CHOCOLATE CHERRY CORDIALS","DARK CHOCOLATE CHERRY CORDIALS","STRAWBERRY TRUFFLE","DARK CHOCOLATE RASPBERRY TRUFFLE","DARK CHOCOLATE CHAMPAGNE TRUFFLE","RASPBERRY CARAMEL JEWEL","IRISH CREME TRUFFLE","WHITE RUSSIAN TRUFFLE","DARK CHOCOLATE CARAMEL MACCHIATO TRUFFLE","ITALIAN ESPRESSO TRUFFLE","WHITE EURO TRUFFLE","DARK CHOCOLATE FRENCH VANILLA TRUFFLE","CHOCOLATE MILKSHAKE TRUFFLE","MILK CHOCOLATE CARAMEL FUDGE BROWNIE TRUFFLE","MILK SEA SALT CARAMEL","DARK CHOCOLATE HIMALAYAN SEA SALT CARAMEL","DARK CHOCOLATE CARAMEL","MILK CHOCOLATE DOUBLE CHOCOLATE CARAMEL","FRESH MINT TRUFFLE","DARK CREME MINTS","MILK CHOCOLATE MAPLE PECAN CREAM","DARK CHOCOLATE MAPLE PECAN CREAM","DARK CHOCOLATE FRENCH VANILLA DREAM","MILK VANILLA DREAMS","DARK CHOCOLATE RASPBERRY CREME","MILK CHOCOLATE RASPBERRY CREME","MILK ORANGE CREME","DARK CHOCOLATE ORANGE CREME","ROOT BEER FLOAT TRUFFLE","MILK CHOCOLATE ENGLISH ALMOND TOFFEE","DARK CINNAMON ALMOND CARAMEL","MILK CHOCOLATE PECAN CARAMEL"];
    const f1Half = ["MILK CHOCOLATE TIRAMISU TRUFFLE","WHITE EURO TRUFFLE","MILK CHOCOLATE FRENCH SEA SALT CARAMEL","DARK CHOCOLATE SEA SALT CARAMEL","MILK CHOCOLATE SWISS PECAN CREAM","PISTACHIO CROWN TRUFFLES"];

    function init() {
        let d = new Date();
        document.getElementById('trackingDate').value = d.toISOString().split('T')[0];
        updateDateDisplay();
        renderTable('f6', f6List, 'f6Body');
        renderTable('f1', f1List, 'f1Body');
        attachHighlight();
        loadAll();
        updateTotals();
    }

    function renderTable(prefix, list, tbodyId) {
        const tbody = document.getElementById(tbodyId);
        tbody.innerHTML = '';
        list.forEach((name, idx) => {
            const id = `${prefix}_${idx}`;
            const isHalf = (prefix==='f6' && f6Half.includes(name)) || (prefix==='f1' && f1Half.includes(name));
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${name} ${isHalf?'<span class="half-badge">Half Plate</span>':''}</td>
                <td><input type="number" id="${id}_am" class="count-input" oninput="calculateRow('${id}')" onkeydown="moveOnEnter(event,'${prefix}',${idx},'am')"></td>
                <td><input type="number" id="${id}_refill" class="count-input" oninput="calculateRow('${id}')" onkeydown="moveOnEnter(event,'${prefix}',${idx},'refill')"></td>
                <td><input type="number" id="${id}_pm" class="count-input" oninput="calculateRow('${id}')" onkeydown="moveOnEnter(event,'${prefix}',${idx},'pm')"></td>
                <td id="${id}_sold" class="sold-cell">0</td>
                <td id="${id}_end" class="end-cell">0</td>`;
            tbody.appendChild(tr);
        });
    }

    function attachHighlight() {
        ['f6Table','f1Table'].forEach(id => {
            document.getElementById(id).addEventListener('focusin', e => {
                if(e.target.tagName==='INPUT') e.target.closest('tr')?.classList.add('highlight-row');
            });
            document.getElementById(id).addEventListener('focusout', e => {
                if(e.target.tagName==='INPUT') e.target.closest('tr')?.classList.remove('highlight-row');
            });
        });
    }

    function moveOnEnter(e,prefix,idx,field) {
        if(e.key==='Enter'||e.key==='Tab') {
            e.preventDefault();
            const list = prefix==='f6'?f6List:f1List;
            if(idx+1 < list.length) document.getElementById(`${prefix}_${idx+1}_${field}`)?.focus();
        }
    }

    function calculateRow(id) {
        const am = parseInt(document.getElementById(`${id}_am`)?.value) || 0;
        const ref = parseInt(document.getElementById(`${id}_refill`)?.value) || 0;
        const pm = parseInt(document.getElementById(`${id}_pm`)?.value) || 0;
        const sold = Math.max(0, (am - pm) + ref);
        document.getElementById(`${id}_sold`).innerText = sold;
        document.getElementById(`${id}_end`).innerText = pm;
        const endEl = document.getElementById(`${id}_end`);
        if(pm>0 && pm<5) endEl.classList.add('low-stock'); else endEl.classList.remove('low-stock');
        updateTotals(); saveAll();
    }

    function updateTotals() {
        let f6=0,f1=0;
        f6List.forEach((_,i)=> f6 += parseInt(document.getElementById(`f6_${i}_end`)?.innerText)||0);
        f1List.forEach((_,i)=> f1 += parseInt(document.getElementById(`f1_${i}_end`)?.innerText)||0);
        document.getElementById('total-f6').innerText = f6;
        document.getElementById('total-f1').innerText = f1;
        document.getElementById('total-grand').innerText = f6+f1;

        const sales = {};
        f6List.forEach((n,i)=>{ let s=parseInt(document.getElementById(`f6_${i}_sold`)?.innerText)||0; if(s>0) sales[n]=(sales[n]||0)+s; });
        f1List.forEach((n,i)=>{ let s=parseInt(document.getElementById(`f1_${i}_sold`)?.innerText)||0; if(s>0) sales[n]=(sales[n]||0)+s; });
        const top = Object.entries(sales).sort((a,b)=>b[1]-a[1]).slice(0,5);
        const listDiv = document.getElementById('topSellersList');
        listDiv.innerHTML = top.length ? top.map(([n,c])=>`<span class="seller-tag">${n} ${c}</span>`).join('') : '<span class="seller-tag">‚Äî</span>';
    }

    function lockAM() {
        document.querySelectorAll('input[id$="_am"]').forEach(i=>i.disabled=true);
        const btn = document.getElementById('lockAmBtn');
        btn.innerText = 'üîí AM Locked'; btn.disabled = true; btn.style.opacity = 0.7;
        showToast('Morning counts locked'); saveAll();
    }

    function switchFloor(f) {
        document.querySelectorAll('.floor-view').forEach(v=>v.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById(`${f}-view`).classList.add('active');
        document.getElementById(`btn-${f}`).classList.add('active');
    }

    function toggleGuide() { document.getElementById('guideCard').classList.toggle('show'); }

    function updateDateDisplay() {
        const val = document.getElementById('trackingDate').value;
        if(val) { const d = new Date(val+'T12:00'); document.getElementById('displayDate').innerText = d.toLocaleDateString('en-US',{weekday:'long', year:'numeric', month:'long', day:'numeric'}); }
    }

    function saveAll() {
        const data = {
            date:document.getElementById('trackingDate').value, oMod:document.getElementById('openingMod').value, cMod:document.getElementById('closingMod').value,
            amLocked:document.getElementById('lockAmBtn').disabled,
            f6:f6List.map((_,i)=>({am:document.getElementById(`f6_${i}_am`)?.value||'', ref:document.getElementById(`f6_${i}_refill`)?.value||'', pm:document.getElementById(`f6_${i}_pm`)?.value||''})),
            f1:f1List.map((_,i)=>({am:document.getElementById(`f1_${i}_am`)?.value||'', ref:document.getElementById(`f1_${i}_refill`)?.value||'', pm:document.getElementById(`f1_${i}_pm`)?.value||''}))
        };
        localStorage.setItem('biss_tracker_ref', JSON.stringify(data));
    }

    function loadAll() {
        const raw = localStorage.getItem('biss_tracker_ref'); if(!raw) return;
        const d = JSON.parse(raw);
        document.getElementById('trackingDate').value = d.date||''; document.getElementById('openingMod').value = d.oMod||''; document.getElementById('closingMod').value = d.cMod||'';
        const load = (list,prefix,arr)=>{ list.forEach((_,i)=>{ if(arr[i]){ document.getElementById(`${prefix}_${i}_am`).value = arr[i].am||''; document.getElementById(`${prefix}_${i}_refill`).value = arr[i].ref||''; document.getElementById(`${prefix}_${i}_pm`).value = arr[i].pm||''; } if(d.amLocked) document.getElementById(`${prefix}_${i}_am`).disabled = true; calculateRow(`${prefix}_${i}`); }); };
        load(f6List,'f6',d.f6); load(f1List,'f1',d.f1);
        if(d.amLocked){ const btn=document.getElementById('lockAmBtn'); btn.innerText='üîí AM Locked'; btn.disabled=true; btn.style.opacity=0.7; }
        updateDateDisplay();
    }

    function confirmReset(){ if(confirm('Clear all data?')){ localStorage.removeItem('biss_tracker_ref'); location.reload(); } }
    function openReportModal(){ document.getElementById('reportModal').style.display='flex'; }
    function closeReportModal(){ document.getElementById('reportModal').style.display='none'; }
    function generateReport(type){
        const date = document.getElementById('displayDate').innerText;
        const mod = document.getElementById(type==='am'?'openingMod':'closingMod').value||'N/A';
        let report = `BISSINGER'S ${type.toUpperCase()} REPORT\n${date}\nMOD: ${mod}\n\n`;
        const sec = (title,list,prefix)=>{ let b=''; list.forEach((n,i)=>{ let am=document.getElementById(`${prefix}_${i}_am`)?.value||0, pm=document.getElementById(`${prefix}_${i}_pm`)?.value||0, sold=document.getElementById(`${prefix}_${i}_sold`)?.innerText||0; if(type==='am' && am>0) b+=`${n} : AM ${am}\n`; if(type==='pm' && (pm>0||sold>0)) b+=`${n} : SOLD ${sold}  |  END ${pm}\n`; }); if(b) report += `--- ${title} ---\n${b}\n`; };
        sec('6TH FLOOR',f6List,'f6'); sec('1ST FLOOR',f1List,'f1');
        const ta = document.createElement('textarea'); ta.value=report; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        showToast('Report copied'); closeReportModal();
    }
    function showToast(m){ const t=document.getElementById('toast'); t.innerText=m; t.style.opacity=1; setTimeout(()=>t.style.opacity=0,2000); }

    window.calculateRow = calculateRow; window.moveOnEnter = moveOnEnter;
</script>
</body>
</html>
