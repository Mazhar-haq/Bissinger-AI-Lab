<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bissinger's Truffle Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .date-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .date-input {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .date-input label {
            font-weight: 600;
            color: #2c3e50;
        }

        .date-input input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .location-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .location-header {
            background: linear-gradient(135deg, #8e44ad, #c0392b);
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .location-header h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .location-header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: #34495e;
            color: white;
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #ddd;
        }

        td {
            padding: 10px 12px;
            border: 1px solid #ddd;
        }

        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        tbody tr:hover {
            background: #e3f2fd;
        }

        input[type="number"] {
            width: 80px;
            padding: 6px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 0.95rem;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #3498db;
        }

        .flavor-name {
            font-weight: 500;
            color: #2c3e50;
        }

        .calculated {
            background: #e8f5e9;
            font-weight: 600;
            color: #2e7d32;
        }

        .summary-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .summary-header {
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .summary-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .summary-card h3 {
            color: #2c3e50;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card p {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }

        .export-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            margin-right: 10px;
        }

        .export-btn:hover {
            background: #229954;
        }

        .save-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
        }

        .save-btn:hover {
            background: #2980b9;
        }

        .clear-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
        }

        .clear-btn:hover {
            background: #c0392b;
        }

        input[type="number"]:disabled {
            background: #e8e8e8;
            cursor: not-allowed;
        }

        @media print {
            .export-btn, .save-btn, .clear-btn {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .date-input {
                flex-direction: column;
                align-items: flex-start;
            }
            
            table {
                font-size: 0.85rem;
            }
            
            input[type="number"] {
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Bissinger's Daily Truffle Inventory Tracker</h1>
    </div>

    <div class="date-section">
        <div class="date-input">
            <label>Date:</label>
            <input type="date" id="trackingDate" value="">
            
            <label style="margin-left: 30px;">Opening MOD:</label>
            <select id="openingMod" style="padding: 8px 12px; border: 2px solid #ddd; border-radius: 5px; font-size: 1rem;">
                <option value="">Select MOD</option>
                <option value="Tom">Tom</option>
                <option value="Arin">Arin</option>
                <option value="Czar">Czar</option>
                <option value="Faith">Faith</option>
                <option value="Gully">Gully</option>
                <option value="Associate">Associate</option>
            </select>
            
            <label style="margin-left: 30px;">Closing MOD:</label>
            <select id="closingMod" style="padding: 8px 12px; border: 2px solid #ddd; border-radius: 5px; font-size: 1rem;">
                <option value="">Select MOD</option>
                <option value="Tom">Tom</option>
                <option value="Arin">Arin</option>
                <option value="Czar">Czar</option>
                <option value="Faith">Faith</option>
                <option value="Gully">Gully</option>
                <option value="Associate">Associate</option>
            </select>
        </div>
        <div style="margin-top: 15px;">
            <button class="save-btn" id="saveBtn">Save AM Counts</button>
            <button class="clear-btn" id="clearBtn">Clear All</button>
        </div>
    </div>

    <!-- 6th Floor Section -->
    <div class="location-section">
        <div class="location-header">
            <h2>6th Floor Location</h2>
            <p>37 Truffle Flavors</p>
        </div>
        <table id="floor6Table">
            <thead>
                <tr>
                    <th style="width: 30%">Truffle Flavor</th>
                    <th style="width: 15%">AM Count</th>
                    <th style="width: 15%">PM Count</th>
                    <th style="width: 15%">Sold</th>
                    <th style="width: 15%">Refill</th>
                    <th style="width: 10%">End Count</th>
                </tr>
            </thead>
            <tbody id="floor6Body">
            </tbody>
        </table>
    </div>

    <!-- 1st Floor Section -->
    <div class="location-section">
        <div class="location-header">
            <h2>1st Floor Location</h2>
            <p>12 Truffle Flavors</p>
        </div>
        <table id="floor1Table">
            <thead>
                <tr>
                    <th style="width: 30%">Truffle Flavor</th>
                    <th style="width: 15%">AM Count</th>
                    <th style="width: 15%">PM Count</th>
                    <th style="width: 15%">Sold</th>
                    <th style="width: 15%">Refill</th>
                    <th style="width: 10%">End Count</th>
                </tr>
            </thead>
            <tbody id="floor1Body">
            </tbody>
        </table>
    </div>

    <!-- Summary Section -->
    <div class="summary-section">
        <div class="summary-header">
            <h2>Daily Summary</h2>
        </div>
        <div class="summary-grid">
            <div class="summary-card">
                <h3>6th Floor Total Sold</h3>
                <p id="floor6Total">0</p>
            </div>
            <div class="summary-card">
                <h3>1st Floor Total Sold</h3>
                <p id="floor1Total">0</p>
            </div>
            <div class="summary-card">
                <h3>Combined Total Sold</h3>
                <p id="combinedTotal">0</p>
            </div>
            <div class="summary-card">
                <h3>Total Refills</h3>
                <p id="totalRefills">0</p>
            </div>
        </div>
        <button class="export-btn" id="exportBtn">Export to CSV</button>
        <button class="export-btn" id="printBtn">Print Report</button>
    </div>

    <script>
        const floor6Flavors = [
            "Birthday Cake Truffle",
            "Wedding Cake Truffle",
            "Root Beer Float Truffle",
            "Milk Chocolate Raspberry Cream",
            "Dark Chocolate Candy Cane",
            "Dark Raspberry Truffle",
            "Creme Brulee Truffle",
            "Tiramisu Truffle",
            "Pineapple Upside Down Cake Truffle",
            "Red Velvet Cake Truffle",
            "Irish Cream Truffle",
            "Chocolate Souffle Truffle",
            "White Euro Truffle",
            "White Russian Truffle",
            "Chocolate Milk Shake Truffle",
            "Dark Chocolate Caramel Macchiato Truffle",
            "German Chocolate Truffle",
            "Dark Chocolate Cherry Cordials",
            "Milk Swiss Chocolate Truffle",
            "Dark Swiss Chocolate Truffle",
            "Dark Sea Salt Caramel Truffle",
            "Strawberry Truffle",
            "Strawberry Cheese Cake Truffle",
            "Pistachio Crown Truffle",
            "Italian Espresso Truffle",
            "Dark Chocolate Caramel",
            "Fresh Mint Truffle",
            "Dark Creme Mints",
            "Milk Sea Salt Caramel",
            "Dark Cinnamon Almond Caramel",
            "Milk Chocolate Swiss Pecan Cream",
            "Milk Vanilla Dreams",
            "French Vanilla B",
            "Milk Chocolate English Almond Toffee",
            "Dark Chocolate English Almond Toffee",
            "Dark Lemon Creme",
            "Raspberry Caramel Jewel"
        ];

        const floor1Flavors = [
            "Birthday Cake Truffle",
            "Wedding Cake Truffle",
            "White Euro Truffle",
            "Dark Chocolate Sea Salt Caramel",
            "White Chocolate Christmas Cookie Truffle",
            "Dark Chocolate Candy Cane",
            "White Chocolate Eggnog",
            "Milk Chocolate Caramel Fudge Brownie",
            "Milk Chocolate Peanut Butter",
            "Milk Chocolate French Salt Caramel",
            "Cherry Cordials",
            "Milk Chocolate Swiss Pecan Creme"
        ];

        // Auto-save function
        function saveData() {
            try {
                const data = {
                    date: document.getElementById('trackingDate').value,
                    openingMod: document.getElementById('openingMod').value,
                    closingMod: document.getElementById('closingMod').value,
                    floor6: {},
                    floor1: {}
                };

                // Save 6th floor data
                floor6Flavors.forEach((_, idx) => {
                    const id = `f6_${idx}`;
                    const amInput = document.getElementById(`${id}_am`);
                    const pmInput = document.getElementById(`${id}_pm`);
                    const refillInput = document.getElementById(`${id}_refill`);
                    
                    if (amInput && pmInput && refillInput) {
                        data.floor6[id] = {
                            am: amInput.value,
                            pm: pmInput.value,
                            refill: refillInput.value,
                            locked: amInput.disabled
                        };
                    }
                });

                // Save 1st floor data
                floor1Flavors.forEach((_, idx) => {
                    const id = `f1_${idx}`;
                    const amInput = document.getElementById(`${id}_am`);
                    const pmInput = document.getElementById(`${id}_pm`);
                    const refillInput = document.getElementById(`${id}_refill`);
                    
                    if (amInput && pmInput && refillInput) {
                        data.floor1[id] = {
                            am: amInput.value,
                            pm: pmInput.value,
                            refill: refillInput.value,
                            locked: amInput.disabled
                        };
                    }
                });

                // Save to browser storage
                localStorage.setItem('bissingersTrackerData', JSON.stringify(data));
                console.log('Data saved successfully');
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        // Load saved data
        function loadSavedData() {
            try {
                const savedData = localStorage.getItem('bissingersTrackerData');
                if (!savedData) {
                    console.log('No saved data found');
                    return;
                }

                const data = JSON.parse(savedData);

                // Restore date and MODs
                if (data.date) document.getElementById('trackingDate').value = data.date;
                if (data.openingMod) document.getElementById('openingMod').value = data.openingMod;
                if (data.closingMod) document.getElementById('closingMod').value = data.closingMod;

                // Wait for rows to be created
                setTimeout(() => {
                    // Restore 6th floor data
                    if (data.floor6) {
                        Object.keys(data.floor6).forEach(id => {
                            const item = data.floor6[id];
                            const amInput = document.getElementById(`${id}_am`);
                            const pmInput = document.getElementById(`${id}_pm`);
                            const refillInput = document.getElementById(`${id}_refill`);
                            
                            if (amInput) {
                                amInput.value = item.am || 0;
                                if (item.locked) amInput.disabled = true;
                            }
                            if (pmInput) pmInput.value = item.pm || 0;
                            if (refillInput) refillInput.value = item.refill || 0;
                            
                            calculate(id);
                        });
                    }

                    // Restore 1st floor data
                    if (data.floor1) {
                        Object.keys(data.floor1).forEach(id => {
                            const item = data.floor1[id];
                            const amInput = document.getElementById(`${id}_am`);
                            const pmInput = document.getElementById(`${id}_pm`);
                            const refillInput = document.getElementById(`${id}_refill`);
                            
                            if (amInput) {
                                amInput.value = item.am || 0;
                                if (item.locked) amInput.disabled = true;
                            }
                            if (pmInput) pmInput.value = item.pm || 0;
                            if (refillInput) refillInput.value = item.refill || 0;
                            
                            calculate(id);
                        });
                    }

                    updateSummary();
                    
                    // Show notification
                    showNotification('âœ“ Previous data restored', '#27ae60');
                }, 200);
            } catch (error) {
                console.error('Error loading saved data:', error);
            }
        }

        // Show notification
        function showNotification(message, color) {
            const notification = document.createElement('div');
            notification.style.cssText = `position: fixed; top: 20px; right: 20px; background: ${color}; color: white; padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 9999; font-weight: 600;`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Create row
        function createRow(flavor, id) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="flavor-name">${flavor}</td>
                <td><input type="number" class="am-input" id="${id}_am" min="0" value="0"></td>
                <td><input type="number" class="pm-input" id="${id}_pm" min="0" value="0"></td>
                <td class="calculated" id="${id}_sold">0</td>
                <td><input type="number" class="refill-input" id="${id}_refill" min="0" value="0"></td>
                <td class="calculated" id="${id}_end">0</td>
            `;
            return row;
        }

        // Calculate
        function calculate(id) {
            const am = parseInt(document.getElementById(`${id}_am`).value) || 0;
            const pm = parseInt(document.getElementById(`${id}_pm`).value) || 0;
            const refill = parseInt(document.getElementById(`${id}_refill`).value) || 0;
            
            const sold = Math.max(0, am - pm);
            const endCount = pm + refill;
            
            document.getElementById(`${id}_sold`).textContent = sold;
            document.getElementById(`${id}_end`).textContent = endCount;
            
            updateSummary();
        }

        // Update summary
        function updateSummary() {
            let floor6Sold = 0;
            let floor1Sold = 0;
            let totalRefills = 0;

            // Calculate 6th floor
            floor6Flavors.forEach((_, idx) => {
                const sold = parseInt(document.getElementById(`f6_${idx}_sold`).textContent) || 0;
                const refill = parseInt(document.getElementById(`f6_${idx}_refill`).value) || 0;
                floor6Sold += sold;
                totalRefills += refill;
            });

            // Calculate 1st floor
            floor1Flavors.forEach((_, idx) => {
                const sold = parseInt(document.getElementById(`f1_${idx}_sold`).textContent) || 0;
                const refill = parseInt(document.getElementById(`f1_${idx}_refill`).value) || 0;
                floor1Sold += sold;
                totalRefills += refill;
            });

            document.getElementById('floor6Total').textContent = floor6Sold;
            document.getElementById('floor1Total').textContent = floor1Sold;
            document.getElementById('combinedTotal').textContent = floor6Sold + floor1Sold;
            document.getElementById('totalRefills').textContent = totalRefills;
        }

        // Initialize
        document.getElementById('trackingDate').valueAsDate = new Date();

        // Generate rows for 6th floor
        const floor6Body = document.getElementById('floor6Body');
        floor6Flavors.forEach((flavor, idx) => {
            const row = createRow(flavor, `f6_${idx}`);
            floor6Body.appendChild(row);
        });

        // Generate rows for 1st floor
        const floor1Body = document.getElementById('floor1Body');
        floor1Flavors.forEach((flavor, idx) => {
            const row = createRow(flavor, `f1_${idx}`);
            floor1Body.appendChild(row);
        });

        // Load saved data after rows are created
        setTimeout(() => {
            loadSavedData();
        }, 100);

        // Add event listeners to all inputs
        setTimeout(() => {
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('change', function() {
                    const id = this.id.replace(/_am|_pm|_refill/, '');
                    calculate(id);
                    saveData();
                });
            });

            // Add listeners to date and MODs
            document.getElementById('trackingDate').addEventListener('change', saveData);
            document.getElementById('openingMod').addEventListener('change', saveData);
            document.getElementById('closingMod').addEventListener('change', saveData);
        }, 200);

        // Save AM Counts button
        document.getElementById('saveBtn').addEventListener('click', function() {
            const allAMInputs = document.querySelectorAll('input[id$="_am"]');
            allAMInputs.forEach(input => {
                input.disabled = true;
            });
            saveData();
            showNotification('AM counts saved and locked!', '#3498db');
        });

        // Clear All button
        document.getElementById('clearBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to clear all counts? This will delete all saved data and cannot be undone.')) {
                // Clear storage
                localStorage.removeItem('bissingersTrackerData');
                
                // Reset all inputs
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    input.disabled = false;
                    input.value = 0;
                });
                
                // Clear dropdowns
                document.getElementById('openingMod').value = '';
                document.getElementById('closingMod').value = '';
                
                // Clear calculated fields
                document.querySelectorAll('.calculated').forEach(cell => {
                    cell.textContent = '0';
                });
                
                updateSummary();
                showNotification('All data cleared!', '#e74c3c');
            }
        });

        // Export to CSV button
        document.getElementById('exportBtn').addEventListener('click', function() {
            const date = document.getElementById('trackingDate').value;
            const openingMod = document.getElementById('openingMod').value;
            const closingMod = document.getElementById('closingMod').value;
            
            let csv = `Bissinger's Truffle Tracker - ${date}\n`;
            csv += `Opening MOD: ${openingMod}\n`;
            csv += `Closing MOD: ${closingMod}\n\n`;
            
            // 6th Floor Data
            csv += "6TH FLOOR\n";
            csv += "Flavor,AM Count,PM Count,Sold,Refill,End Count\n";
            floor6Flavors.forEach((flavor, idx) => {
                const am = document.getElementById(`f6_${idx}_am`).value;
                const pm = document.getElementById(`f6_${idx}_pm`).value;
                const sold = document.getElementById(`f6_${idx}_sold`).textContent;
                const refill = document.getElementById(`f6_${idx}_refill`).value;
                const end = document.getElementById(`f6_${idx}_end`).textContent;
                csv += `${flavor},${am},${pm},${sold},${refill},${end}\n`;
            });
            
            csv += "\n1ST FLOOR\n";
            csv += "Flavor,AM Count,PM Count,Sold,Refill,End Count\n";
            floor1Flavors.forEach((flavor, idx) => {
                const am = document.getElementById(`f1_${idx}_am`).value;
                const pm = document.getElementById(`f1_${idx}_pm`).value;
                const sold = document.getElementById(`f1_${idx}_sold`).textContent;
                const refill = document.getElementById(`f1_${idx}_refill`).value;
                const end = document.getElementById(`f1_${idx}_end`).textContent;
                csv += `${flavor},${am},${pm},${sold},${refill},${end}\n`;
            });

            csv += `\nSummary\n`;
            csv += `6th Floor Total Sold,${document.getElementById('floor6Total').textContent}\n`;
            csv += `1st Floor Total Sold,${document.getElementById('floor1Total').textContent}\n`;
            csv += `Combined Total Sold,${document.getElementById('combinedTotal').textContent}\n`;
            csv += `Total Refills,${document.getElementById('totalRefills').textContent}\n`;

            // Download
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Bissingers_Tracker_${date}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        });

        // Print button
        document.getElementById('printBtn').addEventListener('click', function() {
            window.print();
        });
    </script>
</body>
</html>
