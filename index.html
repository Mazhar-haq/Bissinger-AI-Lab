<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bissinger's Herald Square Truffle Tracker</title>
    <style>
        :root {
            --bissingers-brown: #3d2b1f; 
            --bissingers-gold: #c5a059;  
            --bissingers-cream: #f9f6f2;
            --primary: var(--bissingers-brown);
            --accent: var(--bissingers-gold);
            --success: #4a6741;
            --danger: #9e2a2b;
            --info: #2c3e50;
            --light: #f4eee8;
            --white: #ffffff;
            --highlight-row-bg: rgba(197, 160, 89, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Optima', 'Palatino', 'Segoe UI', serif; padding: 10px; background: var(--light); color: var(--bissingers-brown); padding-bottom: 280px; }

        .header { background: var(--bissingers-brown); color: var(--bissingers-gold); padding: 20px 10px; border-radius: 4px; margin-bottom: 15px; text-align: center; border-bottom: 3px solid var(--bissingers-gold); position: relative; }
        .header h1 { font-size: 1.2rem; letter-spacing: 1px; text-transform: uppercase; font-weight: 300; margin-bottom: 5px; }
        
        .settings-btn { position: absolute; right: 10px; top: 10px; background: none; border: none; color: var(--bissingers-gold); cursor: pointer; font-size: 1.2rem; }

        .card { background: var(--white); padding: 15px; border-radius: 4px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(61, 43, 31, 0.1); border: 1px solid rgba(197, 160, 89, 0.2); }
        
        .guide-section { font-size: 0.8rem; margin-bottom: 20px; border-left: 3px solid var(--bissingers-gold); padding-left: 15px; }
        .guide-section h3 { font-size: 0.85rem; text-transform: uppercase; margin-bottom: 8px; color: var(--bissingers-brown); }

        .input-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        @media (min-width: 600px) { .input-grid { grid-template-columns: repeat(3, 1fr); } }
        
        .input-group { display: flex; flex-direction: column; gap: 4px; }
        .input-group label { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
        input, select { padding: 8px; border: 1px solid #dcdcdc; border-radius: 2px; width: 100%; font-size: 0.9rem; }

        .floor-tabs { display: flex; gap: 8px; margin-bottom: 15px; position: sticky; top: 0; z-index: 100; background: var(--light); padding: 10px 0; }
        .tab-btn { flex: 1; padding: 12px; background: #e0dcd8; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 0.75rem; color: #666; transition: 0.3s; }
        .tab-btn.active { background: var(--bissingers-brown); color: var(--bissingers-gold); }

        .floor-view { display: none; }
        .floor-view.active { display: block; }

        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        th { background: var(--bissingers-brown); color: var(--bissingers-gold); padding: 8px 4px; font-size: 0.6rem; text-transform: uppercase; }
        td { padding: 8px 4px; border-bottom: 1px solid #f0f0f0; text-align: center; font-size: 0.85rem; transition: background 0.2s; }
        td:first-child { text-align: left; font-weight: bold; font-size: 0.75rem; text-transform: uppercase; }
        
        .highlight-row td {
            background-color: var(--highlight-row-bg) !important;
        }

        .half-plate-badge { 
            display: inline-block; 
            font-size: 10px; 
            background: var(--bissingers-gold); 
            color: white; 
            padding: 1px 4px; 
            border-radius: 3px; 
            margin-left: 5px; 
            vertical-align: middle;
            text-transform: none;
            letter-spacing: 0;
            font-weight: normal;
        }

        .count-input { width: 45px; text-align: center; padding: 4px; border: 1px solid #eee; }
        .count-input:focus { border-color: var(--bissingers-gold); outline: none; background: #fffcf5; }
        .count-input:disabled { background: #f9f9f9; color: #999; border: none; }

        .sold-text { color: var(--success); font-weight: bold; }
        .end-text { font-weight: bold; }
        .low-stock { color: var(--danger); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .summary-footer { position: fixed; bottom: 0; left: 0; right: 0; background: var(--bissingers-brown); color: var(--bissingers-gold); padding: 15px; z-index: 1000; box-shadow: 0 -4px 10px rgba(0,0,0,0.3); }
        .summary-stats { display: flex; justify-content: space-around; align-items: center; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid rgba(197,160,89,0.3); }
        .summary-item { text-align: center; }
        .summary-val { font-size: 1.2rem; font-weight: bold; display: block; }

        .top-sellers-panel { display: block; padding: 5px 10px; }
        .top-sellers-title { font-size: 0.65rem; font-weight: bold; text-transform: uppercase; color: var(--bissingers-gold); margin-bottom: 8px; display: flex; align-items: center; gap: 5px; }
        .top-sellers-grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        .seller-badge { background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; display: flex; align-items: center; gap: 5px; border: 1px solid rgba(197,160,89,0.2); }
        .seller-count { color: #fff; font-weight: bold; }

        .toast { position: fixed; bottom: 120px; left: 50%; transform: translateX(-50%); background: var(--bissingers-brown); color: var(--bissingers-gold); padding: 10px 20px; border-radius: 4px; opacity: 0; transition: 0.3s; z-index: 1001; pointer-events: none; }

        @media print {
            .floor-tabs, .summary-footer, .settings-btn, #guide, button { display: none !important; }
            body { padding: 0; background: white; padding-bottom: 0; }
            .card { box-shadow: none; border: 1px solid #ccc; }
            .floor-view { display: block !important; }
            .highlight-row td { background-color: transparent !important; }
        }
    </style>
</head>
<body onload="init()">

    <div id="toast" class="toast">Action Complete</div>

    <div class="header">
        <button class="settings-btn" onclick="toggleGuide()">üìñ Help</button>
        <h1>Bissinger's Truffle Tracker</h1>
        <p id="displayDate" style="font-size: 0.8rem; opacity: 0.8;"></p>
    </div>

    <div id="guide" class="card" style="display: none;">
        <div class="guide-section">
            <h3>‚òÄÔ∏è Morning Shift</h3>
            <p style="font-size: 0.75rem; margin-bottom: 5px;">Enter counts in <b>AM</b> column. Click <b>Lock AM</b> when done to prevent accidental changes.</p>
        </div>
        <div class="guide-section">
            <h3>üîÑ Two Ways to Track Sales</h3>
            <p style="font-size: 0.75rem; margin-bottom: 5px;"><b>Option 1 - Enter Refill:</b> Enter sold amount in <b>Refill</b> ‚Üí PM auto-calculates (AM - Refill = PM)</p>
            <p style="font-size: 0.75rem; margin-bottom: 5px;"><b>Option 2 - Enter PM:</b> Enter ending count in <b>PM</b> ‚Üí Refill auto-calculates (AM - PM = Refill)</p>
        </div>
        <div class="guide-section">
            <h3>üìä Auto-Calculations</h3>
            <p style="font-size: 0.75rem; margin-bottom: 5px;"><b>Sold</b> shows AM - PM. <b>End</b> shows final PM count. Use whichever method works best for your workflow!</p>
        </div>
        <button onclick="toggleGuide()" style="width: 100%; padding: 8px; background: var(--bissingers-brown); color: var(--bissingers-gold); border: none; border-radius: 4px; cursor: pointer; font-size: 0.7rem;">CLOSE GUIDE</button>
    </div>

    <div class="card">
        <div class="input-grid">
            <div class="input-group">
                <label>Date</label>
                <input type="date" id="trackingDate" onchange="updateDateDisplay(); saveData();">
            </div>
            <div class="input-group">
                <label>Opening MOD</label>
                <select id="openingMod" onchange="saveData()">
                    <option value="">Select...</option>
                    <option>Arin</option><option>Czar</option><option>Faith</option><option>Gully</option><option>Associate</option>
                </select>
            </div>
            <div class="input-group">
                <label>Closing MOD</label>
                <select id="closingMod" onchange="saveData()">
                    <option value="">Select...</option>
                    <option>Arin</option><option>Czar</option><option>Faith</option><option>Gully</option><option>Associate</option>
                </select>
            </div>
        </div>
        <div style="display: flex; gap: 8px; margin-top: 15px;">
            <button id="lockAmBtn" style="flex: 2; padding: 10px; background: var(--bissingers-gold); border: none; font-weight: bold; border-radius: 4px; cursor: pointer;" onclick="lockAM()">Lock AM Counts</button>
            <button style="flex: 1; padding: 10px; background: var(--info); color: white; border: none; font-weight: bold; border-radius: 4px; cursor: pointer;" onclick="openReport()">üìã Report</button>
            <button style="flex: 1; padding: 10px; background: var(--success); color: white; border: none; font-weight: bold; border-radius: 4px; cursor: pointer;" onclick="window.print()">üñ®Ô∏è PDF</button>
        </div>
        <div style="margin-top: 10px;">
            <button style="width: 100%; padding: 8px; background: transparent; color: var(--danger); border: 1px solid var(--danger); font-size: 0.7rem; font-weight: bold; border-radius: 4px; cursor: pointer; text-transform: uppercase;" onclick="confirmReset()">Clear All Today's Data</button>
        </div>
    </div>

    <div class="floor-tabs">
        <button class="tab-btn active" id="btn-f6" onclick="switchFloor('f6')">6th Floor Case</button>
        <button class="tab-btn" id="btn-f1" onclick="switchFloor('f1')">1st Floor Case</button>
    </div>

    <div id="f6-view" class="floor-view active">
        <div class="card" style="padding: 5px;">
            <div class="table-container">
                <table id="f6Table">
                    <thead>
                        <tr>
                            <th style="width: 40%;">Flavor</th>
                            <th>AM</th>
                            <th>Refill</th>
                            <th>PM</th>
                            <th>Sold</th>
                            <th>End</th>
                        </tr>
                    </thead>
                    <tbody id="f6Body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="f1-view" class="floor-view">
        <div class="card" style="padding: 5px;">
            <div class="table-container">
                <table id="f1Table">
                    <thead>
                        <tr>
                            <th style="width: 40%;">Flavor</th>
                            <th>AM</th>
                            <th>Refill</th>
                            <th>PM</th>
                            <th>Sold</th>
                            <th>End</th>
                        </tr>
                    </thead>
                    <tbody id="f1Body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="summary-footer">
        <div class="summary-stats">
            <div class="summary-item">
                <span style="font-size: 0.6rem;">F6 STOCK</span>
                <span class="summary-val" id="total-f6">0</span>
            </div>
            <div class="summary-item">
                <span style="font-size: 0.6rem;">F1 STOCK</span>
                <span class="summary-val" id="total-f1">0</span>
            </div>
            <div class="summary-item">
                <span style="font-size: 0.6rem;">GRAND TOTAL</span>
                <span class="summary-val" id="total-grand" style="color:white; border-bottom: 2px solid var(--bissingers-gold);">0</span>
            </div>
        </div>
        
        <div class="top-sellers-panel">
            <div class="top-sellers-title">üèÜ Top Sellers Today</div>
            <div id="topSellersList" class="top-sellers-grid">
                <div class="seller-badge" style="opacity: 0.5;">Enter PM counts to track...</div>
            </div>
        </div>
    </div>

    <div id="reportModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:3000; justify-content:center; align-items:center;">
        <div style="background:white; padding:25px; border-radius:8px; width:90%; max-width:350px; text-align:center;">
            <h3>Report Generation</h3>
            <button style="width:100%; padding:12px; margin:8px 0; background:var(--info); color:white; border:none; border-radius:4px; font-weight:bold; cursor:pointer;" onclick="generateReport('am')">Copy AM Report</button>
            <button style="width:100%; padding:12px; margin:8px 0; background:var(--bissingers-brown); color:var(--bissingers-gold); border:none; border-radius:4px; font-weight:bold; cursor:pointer;" onclick="generateReport('pm')">Copy PM Report</button>
            <button style="width:100%; padding:10px; margin-top:10px; border:none; background:#eee; cursor:pointer;" onclick="closeReport()">Cancel</button>
        </div>
    </div>

    <script>
        // UPDATED 6TH FLOOR LIST
        const f6List = [
            "BIRTHDAY CAKE TRUFFLE",
            "WEDDING CAKE TRUFFLE",
            "MILK CHOCOLATE CARAMEL CHEESECAKE TRUFFLE",
            "RED VELVET CAKE TRUFFLE",
            "MILK CHOCOLATE CHERRY CORDIALS",
            "DARK CHOCOLATE CHERRY CORDIALS",
            "STRAWBERRY TRUFFLE",
            "DARK CHOCOLATE RASPBERRY TRUFFLE",
            "DARK CHOCOLATE CHAMPAGNE TRUFFLE",
            "RASPBERRY CARAMEL JEWEL",
            "STRAWBERRY CHEESECAKE TRUFFLE",
            "IRISH CREME TRUFFLE",
            "WHITE RUSSIAN TRUFFLE",
            "CREME BR√õL√âE TRUFFLE",
            "TIRAMISU TRUFFLE",
            "DARK CHOCOLATE CARAMEL MACCHIATO TRUFFLE",
            "ITALIAN ESPRESSO TRUFFLE",
            "GERMAN CHOCOLATE TRUFFLE",
            "DARK CHOCOLATE SOUFFL√â TRUFFLE",
            "PINEAPPLE UPSIDE DOWN CAKE TRUFFLE",
            "WHITE EURO TRUFFLE",
            "DARK CHOCOLATE FRENCH VANILLA TRUFFLE",
            "FRENCH VANILLA \"B\"",
            "CHOCOLATE MILKSHAKE TRUFFLE",
            "MILK CHOCOLATE CARAMEL FUDGE BROWNIE TRUFFLE",
            "MILK SWISS CHOCOLATE TRUFFLE",
            "DARK SWISS CHOCOLATE TRUFFLE",
            "MILK SEA SALT CARAMEL",
            "DARK CHOCOLATE HIMALAYAN SEA SALT CARAMEL",
            "DARK CHOCOLATE CARAMEL",
            "MILK CHOCOLATE DOUBLE CHOCOLATE CARAMEL",
            "DARK SEA SALT CARAMEL TRUFFLE",
            "FRESH MINT TRUFFLE",
            "DARK CREME MINTS",
            "MILK CHOCOLATE MAPLE PECAN CREAM",
            "DARK CHOCOLATE MAPLE PECAN CREAM",
            "PISTACHIO CROWN TRUFFLE",
            "DARK CHOCOLATE FRENCH VANILLA DREAM",
            "MILK VANILLA DREAMS",
            "LEMON TEARDROP TRUFFLE",
            "MILK CHOCOLATE SWISS PECAN CREAM",
            "DARK CHOCOLATE RASPBERRY CREME",
            "MILK CHOCOLATE RASPBERRY CREME",
            "MILK ORANGE CRE
          
