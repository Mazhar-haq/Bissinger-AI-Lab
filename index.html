<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bissinger's Truffle Tracker</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #8e44ad;
            --success: #27ae60;
            --danger: #e74c3c;
            --light: #f5f5f5;
            --white: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            padding: 15px;
            background: var(--light);
            color: #333;
            line-height: 1.5;
        }

        /* Header Styling */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .header h1 { font-size: 1.75rem; margin-bottom: 5px; }
        .header p { opacity: 0.9; font-size: 0.9rem; }

        /* Inputs & Controls */
        .card {
            background: var(--white);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .date-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .input-group label {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
        }

        input, select {
            padding: 10px;
            border: 2px solid #eee;
            border-radius: 6px;
            font-size: 1rem;
            width: 100%;
        }

        input:focus { outline: none; border-color: var(--secondary); }

        /* Search Bar */
        .search-wrapper {
            position: relative;
            margin-top: 10px;
        }

        .search-wrapper input {
            padding-left: 35px;
            border-radius: 25px;
            background: #f9f9f9;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.5;
        }

        /* Table Desktop Styles */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: var(--primary);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th { padding: 12px; text-align: left; font-size: 0.85rem; }
        td { padding: 10px; border-bottom: 1px solid #eee; }

        /* Mobile Card View Transformation */
        @media (max-width: 768px) {
            table, thead, tbody, th, td, tr { display: block; }
            
            thead tr { position: absolute; top: -9999px; left: -9999px; }

            tr {
                border: 1px solid #eee;
                margin-bottom: 15px;
                border-radius: 8px;
                background: white;
                padding: 10px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            }

            td {
                border: none;
                position: relative;
                padding-left: 50%;
                text-align: right;
                min-height: 40px;
                display: flex;
                align-items: center;
                justify-content: flex-end;
            }

            td:before {
                content: attr(data-label);
                position: absolute;
                left: 10px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
                color: var(--primary);
                font-size: 0.8rem;
            }

            td.flavor-name {
                background: #f8f9fa;
                display: block;
                text-align: left;
                padding: 10px;
                font-weight: bold;
                font-size: 1.1rem;
                border-radius: 4px;
                margin-bottom: 10px;
                padding-left: 10px;
            }

            td.flavor-name:before { content: ""; }
            
            input[type="number"] {
                max-width: 120px !important;
                text-align: center;
            }
        }

        /* Helpers */
        .calculated { font-weight: bold; color: var(--success); }
        .error { color: var(--danger); }
        
        .btn-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover { opacity: 0.9; }
        .btn-save { background: var(--secondary); }
        .btn-clear { background: var(--danger); }
        .btn-export { background: var(--success); }
        .btn-copy { background: var(--accent); }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .summary-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .summary-val { font-size: 1.5rem; font-weight: 800; display: block; color: var(--primary); }
        .summary-lbl { font-size: 0.7rem; text-transform: uppercase; color: #666; }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 1000;
        }

        @media print {
            .btn-group, .search-wrapper, .btn-save, .btn-clear { display: none !important; }
        }
    </style>
</head>
<body onload="init()">

    <div id="toast" class="toast">Data Saved</div>

    <div class="header">
        <h1>Bissinger's Tracker</h1>
        <p id="displayDate"></p>
    </div>

    <div class="card">
        <div class="date-grid">
            <div class="input-group">
                <label>Inventory Date</label>
                <input type="date" id="trackingDate" onchange="updateDateDisplay(); saveData();">
            </div>
            <div class="input-group">
                <label>Opening MOD</label>
                <select id="openingMod" onchange="saveData()">
                    <option value="">Select...</option>
                    <option>Tom</option><option>Arin</option><option>Czar</option>
                    <option>Faith</option><option>Gully</option><option>Associate</option>
                </select>
            </div>
            <div class="input-group">
                <label>Closing MOD</label>
                <select id="closingMod" onchange="saveData()">
                    <option value="">Select...</option>
                    <option>Tom</option><option>Arin</option><option>Czar</option>
                    <option>Faith</option><option>Gully</option><option>Associate</option>
                </select>
            </div>
        </div>
        <div class="btn-group">
            <button class="btn btn-save" onclick="lockAM()">Lock AM Counts</button>
            <button class="btn btn-clear" onclick="clearAll()">Reset Form</button>
        </div>
    </div>

    <!-- 6th Floor -->
    <div class="card">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
            <h2 style="font-size: 1.2rem;">6th Floor Stock</h2>
            <div class="search-wrapper">
                <span class="search-icon">üîç</span>
                <input type="text" placeholder="Filter flavors..." onkeyup="filterList(this, 'floor6Body')">
            </div>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Flavor</th>
                        <th>AM</th>
                        <th>PM</th>
                        <th>Sold</th>
                        <th>Refill</th>
                        <th>End</th>
                    </tr>
                </thead>
                <tbody id="floor6Body"></tbody>
            </table>
        </div>
    </div>

    <!-- 1st Floor -->
    <div class="card">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
            <h2 style="font-size: 1.2rem;">1st Floor Stock</h2>
            <div class="search-wrapper">
                <span class="search-icon">üîç</span>
                <input type="text" placeholder="Filter flavors..." onkeyup="filterList(this, 'floor1Body')">
            </div>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Flavor</th>
                        <th>AM</th>
                        <th>PM</th>
                        <th>Sold</th>
                        <th>Refill</th>
                        <th>End</th>
                    </tr>
                </thead>
                <tbody id="floor1Body"></tbody>
            </table>
        </div>
    </div>

    <!-- Summary -->
    <div class="card">
        <h2 style="margin-bottom: 15px; font-size: 1.2rem;">Daily Summary</h2>
        <div class="summary-grid">
            <div class="summary-item"><span class="summary-val" id="f6Total">0</span><span class="summary-lbl">6th Sold</span></div>
            <div class="summary-item"><span class="summary-val" id="f1Total">0</span><span class="summary-lbl">1st Sold</span></div>
            <div class="summary-item"><span class="summary-val" id="combinedTotal">0</span><span class="summary-lbl">Total Sold</span></div>
            <div class="summary-item"><span class="summary-val" id="refillTotal">0</span><span class="summary-lbl">Total Refill</span></div>
        </div>
        <div class="btn-group">
            <button class="btn btn-export" onclick="exportCSV()">Download CSV</button>
            <button class="btn btn-copy" onclick="copySummary()">Copy Summary</button>
        </div>
    </div>

    <script>
        const f6List = ["Birthday Cake Truffle", "Wedding Cake Truffle", "Root Beer Float Truffle", "Milk Chocolate Raspberry Cream", "Dark Chocolate Candy Cane", "Dark Raspberry Truffle", "Creme Brulee Truffle", "Tiramisu Truffle", "Pineapple Upside Down Cake Truffle", "Red Velvet Cake Truffle", "Irish Cream Truffle", "Chocolate Souffle Truffle", "White Euro Truffle", "White Russian Truffle", "Chocolate Milk Shake Truffle", "Dark Chocolate Caramel Macchiato Truffle", "German Chocolate Truffle", "Dark Chocolate Cherry Cordials", "Milk Swiss Chocolate Truffle", "Dark Swiss Chocolate Truffle", "Dark Sea Salt Caramel Truffle", "Strawberry Truffle", "Strawberry Cheese Cake Truffle", "Pistachio Crown Truffle", "Italian Espresso Truffle", "Dark Chocolate Caramel", "Fresh Mint Truffle", "Dark Creme Mints", "Milk Sea Salt Caramel", "Dark Cinnamon Almond Caramel", "Milk Chocolate Swiss Pecan Cream", "Milk Vanilla Dreams", "French Vanilla B", "Milk Chocolate English Almond Toffee", "Dark Chocolate English Almond Toffee", "Dark Lemon Creme", "Raspberry Caramel Jewel"];
        const f1List = ["Birthday Cake Truffle", "Wedding Cake Truffle", "White Euro Truffle", "Dark Chocolate Sea Salt Caramel", "White Chocolate Christmas Cookie Truffle", "Dark Chocolate Candy Cane", "White Chocolate Eggnog", "Milk Chocolate Caramel Fudge Brownie", "Milk Chocolate Peanut Butter", "Milk Chocolate French Salt Caramel", "Cherry Cordials", "Milk Chocolate Swiss Pecan Creme"];

        function init() {
            const dateInput = document.getElementById('trackingDate');
            if (!dateInput.value) dateInput.valueAsDate = new Date();
            updateDateDisplay();

            renderRows(f6List, 'floor6Body', 'f6');
            renderRows(f1List, 'floor1Body', 'f1');
            loadData();
        }

        function renderRows(list, containerId, prefix) {
            const container = document.getElementById(containerId);
            list.forEach((name, i) => {
                const id = `${prefix}_${i}`;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="flavor-name">${name}</td>
                    <td data-label="AM"><input type="number" id="${id}_am" oninput="calc('${id}')" placeholder="0"></td>
                    <td data-label="PM"><input type="number" id="${id}_pm" oninput="calc('${id}')" placeholder="0"></td>
                    <td data-label="Sold" class="calculated" id="${id}_sold">0</td>
                    <td data-label="Refill"><input type="number" id="${id}_refill" oninput="calc('${id}')" placeholder="0"></td>
                    <td data-label="End" class="calculated" id="${id}_end">0</td>
                `;
                container.appendChild(row);
            });
        }

        function calc(id) {
            const am = parseInt(document.getElementById(`${id}_am`).value) || 0;
            const pm = parseInt(document.getElementById(`${id}_pm`).value) || 0;
            const refill = parseInt(document.getElementById(`${id}_refill`).value) || 0;
            
            const sold = am - pm;
            const soldEl = document.getElementById(`${id}_sold`);
            soldEl.textContent = sold;
            soldEl.className = sold < 0 ? 'calculated error' : 'calculated';

            document.getElementById(`${id}_end`).textContent = pm + refill;
            updateTotals();
            saveData();
        }

        function updateTotals() {
            const sumSold = (prefix, list) => list.reduce((acc, _, i) => acc + (parseInt(document.getElementById(`${prefix}_${i}_sold`).textContent) || 0), 0);
            const sumRefill = (prefix, list) => list.reduce((acc, _, i) => acc + (parseInt(document.getElementById(`${prefix}_${i}_refill`).value) || 0), 0);

            const f6S = sumSold('f6', f6List);
            const f1S = sumSold('f1', f1List);
            const ref = sumRefill('f6', f6List) + sumRefill('f1', f1List);

            document.getElementById('f6Total').textContent = f6S;
            document.getElementById('f1Total').textContent = f1S;
            document.getElementById('combinedTotal').textContent = f6S + f1S;
            document.getElementById('refillTotal').textContent = ref;
        }

        function saveData() {
            const data = {
                date: document.getElementById('trackingDate').value,
                open: document.getElementById('openingMod').value,
                close: document.getElementById('closingMod').value,
                f6: getValues('f6', f6List),
                f1: getValues('f1', f1List)
            };
            localStorage.setItem('truffle_data', JSON.stringify(data));
        }

        function getValues(prefix, list) {
            return list.map((_, i) => ({
                am: document.getElementById(`${prefix}_${i}_am`).value,
                pm: document.getElementById(`${prefix}_${i}_pm`).value,
                ref: document.getElementById(`${prefix}_${i}_refill`).value,
                locked: document.getElementById(`${prefix}_${i}_am`).disabled
            }));
        }

        function loadData() {
            const raw = localStorage.getItem('truffle_data');
            if (!raw) return;
            const data = JSON.parse(raw);
            
            document.getElementById('trackingDate').value = data.date;
            document.getElementById('openingMod').value = data.open;
            document.getElementById('closingMod').value = data.close;
            updateDateDisplay();

            if(data.f6) setValues('f6', data.f6);
            if(data.f1) setValues('f1', data.f1);
            updateTotals();
        }

        function setValues(prefix, items) {
            items.forEach((item, i) => {
                const amEl = document.getElementById(`${prefix}_${i}_am`);
                if(amEl) {
                    amEl.value = item.am;
                    document.getElementById(`${prefix}_${i}_pm`).value = item.pm;
                    document.getElementById(`${prefix}_${i}_refill`).value = item.ref;
                    if (item.locked) amEl.disabled = true;
                    calc(`${prefix}_${i}`);
                }
            });
        }

        function lockAM() {
            if (!confirm("Lock morning counts? This prevents editing for the rest of the shift.")) return;
            document.querySelectorAll('input[id$="_am"]').forEach(el => el.disabled = true);
            saveData();
            showToast("AM Counts Locked");
        }

        function clearAll() {
            if (!confirm("Clear everything? This resets the whole form.")) return;
            localStorage.clear();
            location.reload();
        }

        function filterList(input, bodyId) {
            const term = input.value.toLowerCase();
            const rows = document.getElementById(bodyId).getElementsByTagName('tr');
            for (let row of rows) {
                const name = row.querySelector('.flavor-name').textContent.toLowerCase();
                row.style.display = name.includes(term) ? "" : "none";
            }
        }

        function updateDateDisplay() {
            const dateInput = document.getElementById('trackingDate').value;
            if (!dateInput) return;
            const d = new Date(dateInput);
            document.getElementById('displayDate').textContent = d.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' });
        }

        function copySummary() {
            const date = document.getElementById('displayDate').textContent;
            const total = document.getElementById('combinedTotal').textContent;
            const text = `Truffle Inventory: ${date}\nTotal Sold: ${total}\n6th Floor: ${document.getElementById('f6Total').textContent}\n1st Floor: ${document.getElementById('f1Total').textContent}`;
            
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showToast("Summary Copied!");
        }

        function exportCSV() {
            let csv = "Flavor,AM,PM,Sold,Refill,End\n";
            const addRows = (list, prefix) => list.forEach((name, i) => {
                csv += `"${name}",${document.getElementById(`${prefix}_${i}_am`).value || 0},${document.getElementById(`${prefix}_${i}_pm`).value || 0},${document.getElementById(`${prefix}_${i}_sold`).textContent},${document.getElementById(`${prefix}_${i}_refill`).value || 0},${document.getElementById(`${prefix}_${i}_end`).textContent}\n`;
            });
            csv += "6TH FLOOR\n"; addRows(f6List, 'f6');
            csv += "\n1ST FLOOR\n"; addRows(f1List, 'f1');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Truffles_${document.getElementById('trackingDate').value}.csv`;
            a.click();
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.style.opacity = 1;
            setTimeout(() => t.style.opacity = 0, 2000);
        }
    </script>
</body>
</html>
